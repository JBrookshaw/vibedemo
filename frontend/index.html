<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>NFL Sentiment PoC</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px }
      .team { margin: 8px }
    </style>
  </head>
  <body>
    <h1>NFL Sentiment PoC</h1>
    <div id="teams">
      <button class="team" data-team="patriots">Patriots</button>
      <button class="team" data-team="cowboys">Cowboys</button>
      <button class="team" data-team="packers">Packers</button>
    </div>
    <div>
      <button id="generate" disabled>Generate</button>
    </div>
    <div id="status"></div>
    <div id="result"></div>

    <script>
      let selected = null
      document.querySelectorAll('.team').forEach(b => {
        b.addEventListener('click', () => {
          selected = b.dataset.team
          document.getElementById('generate').disabled = false
          document.getElementById('status').innerText = 'Selected: ' + selected
        })
      })

      document.getElementById('generate').addEventListener('click', async () => {
        if (!selected) return
        document.getElementById('status').innerText = 'Ingesting...'
        const ingest = await fetch('http://localhost:8000/ingest', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({team_id: selected, timeframe: '24h', use_verified_weighting: true})
        }).then(r => r.json())
        document.getElementById('status').innerText = 'Analysis: ' + ingest.analysis_id
        const analysis = await fetch('http://localhost:8000/analysis/' + ingest.analysis_id).then(r => r.json())
        document.getElementById('status').innerText = 'Generating image...'
        const gen = await fetch('http://localhost:8000/generate', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({analysis_id: ingest.analysis_id})
        }).then(r => r.json())
        document.getElementById('status').innerText = 'Done: ' + gen.image_id
        const img = document.createElement('img')
        img.src = 'file://' + gen.image_path
        img.style.maxWidth = '800px'
        document.getElementById('result').innerHTML = ''
        document.getElementById('result').appendChild(img)
      })
    </script>
  </body>
</html>
